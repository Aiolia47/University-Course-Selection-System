# 数据模型

## User用户模型

**用途:** 表示系统用户（学生和管理员）的基本信息和身份认证

**关键属性:**
- id: string - 用户唯一标识符
- studentId: string - 学号（学生用户）
- username: string - 用户名
- email: string - 邮箱地址
- passwordHash: string - 密码哈希
- role: UserRole - 用户角色（学生/管理员）
- status: UserStatus - 用户状态
- profile: UserProfile - 用户详细信息
- createdAt: Date - 创建时间
- updatedAt: Date - 更新时间

### TypeScript接口

```typescript
interface User {
  id: string;
  studentId?: string;
  username: string;
  email: string;
  passwordHash: string;
  role: UserRole;
  status: UserStatus;
  profile: UserProfile;
  createdAt: Date;
  updatedAt: Date;
}

interface UserProfile {
  firstName: string;
  lastName: string;
  avatar?: string;
  phone?: string;
  major?: string;
  grade?: string;
  class?: string;
}

enum UserRole {
  STUDENT = 'student',
  ADMIN = 'admin'
}

enum UserStatus {
  ACTIVE = 'active',
  INACTIVE = 'inactive',
  SUSPENDED = 'suspended'
}
```

### 关系关系

- 一对多关系: User -> Selection (一个用户可以选择多门课程)
- 一对多关系: User -> AuditLog (用户的操作审计日志)

## Course课程模型

**用途:** 表示课程的基本信息、教学安排和选课限制

**关键属性:**
- id: string - 课程唯一标识符
- code: string - 课程代码
- name: string - 课程名称
- description: string - 课程描述
- credits: number - 学分数
- teacher: string - 授课教师
- capacity: number - 课程容量
- enrolled: number - 已选课人数
- schedule: CourseSchedule - 上课安排
- prerequisites: string[] - 先修课程要求
- status: CourseStatus - 课程状态
- createdAt: Date - 创建时间
- updatedAt: Date - 更新时间

### TypeScript接口

```typescript
interface Course {
  id: string;
  code: string;
  name: string;
  description: string;
  credits: number;
  teacher: string;
  capacity: number;
  enrolled: number;
  schedule: CourseSchedule;
  prerequisites: string[];
  status: CourseStatus;
  createdAt: Date;
  updatedAt: Date;
}

interface CourseSchedule {
  dayOfWeek: DayOfWeek[];
  startTime: string;
  endTime: string;
  location: string;
  weeks: number[];
}

enum DayOfWeek {
  MONDAY = 1,
  TUESDAY = 2,
  WEDNESDAY = 3,
  THURSDAY = 4,
  FRIDAY = 5,
  SATURDAY = 6,
  SUNDAY = 7
}

enum CourseStatus {
  DRAFT = 'draft',
  PUBLISHED = 'published',
  CANCELLED = 'cancelled',
  COMPLETED = 'completed'
}
```

### 关系关系

- 一对多关系: Course -> Selection (一门课程可以被多个学生选择)
- 多对多关系: Course -> Course (通过先修课程关系)

## Selection选课记录模型

**用途:** 记录学生的选课状态和选课历史

**关键属性:**
- id: string - 选课记录唯一标识符
- userId: string - 学生ID
- courseId: string - 课程ID
- status: SelectionStatus - 选课状态
- selectedAt: Date - 选课时间
- confirmedAt?: Date - 确认时间
- cancelledAt?: Date - 取消时间
- notes?: string - 备注信息

### TypeScript接口

```typescript
interface Selection {
  id: string;
  userId: string;
  courseId: string;
  status: SelectionStatus;
  selectedAt: Date;
  confirmedAt?: Date;
  cancelledAt?: Date;
  notes?: string;
}

enum SelectionStatus {
  PENDING = 'pending',
  CONFIRMED = 'confirmed',
  CANCELLED = 'cancelled',
  COMPLETED = 'completed'
}
```

### 关系关系

- 多对一关系: Selection -> User (选课记录属于某个用户)
- 多对一关系: Selection -> Course (选课记录对应某门课程)

## Permission权限模型

**用途:** 定义系统权限和角色权限关系

**关键属性:**
- id: string - 权限唯一标识符
- name: string - 权限名称
- description: string - 权限描述
- resource: string - 资源类型
- action: string - 操作类型
- conditions?: PermissionCondition[] - 权限条件

### TypeScript接口

```typescript
interface Permission {
  id: string;
  name: string;
  description: string;
  resource: string;
  action: string;
  conditions?: PermissionCondition[];
}

interface PermissionCondition {
  field: string;
  operator: string;
  value: any;
}

interface RolePermission {
  id: string;
  roleId: string;
  permissionId: string;
  grantedAt: Date;
  grantedBy: string;
}
```

### 关系关系

- 多对多关系: Role -> Permission (角色拥有多个权限)
- 一对多关系: Permission -> RolePermission

## AuditLog审计日志模型

**用途:** 记录系统操作审计日志，支持安全审计和问题追踪

**关键属性:**
- id: string - 日志记录唯一标识符
- userId: string - 操作用户ID
- action: string - 操作类型
- resource: string - 操作资源
- resourceId?: string - 资源ID
- details: Record<string, any> - 操作详情
- ipAddress: string - IP地址
- userAgent: string - 用户代理
- timestamp: Date - 操作时间

### TypeScript接口

```typescript
interface AuditLog {
  id: string;
  userId: string;
  action: string;
  resource: string;
  resourceId?: string;
  details: Record<string, any>;
  ipAddress: string;
  userAgent: string;
  timestamp: Date;
}
```

### 关系关系

- 多对一关系: AuditLog -> User (日志记录属于某个用户)
